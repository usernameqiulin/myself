<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Interface.js | @bone/channel</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="channel&#x4E3A;&#x57FA;&#x4E8E;mqtt&#x7684;&#x957F;&#x8FDE;&#x63A5;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#x5C01;&#x88C5;&#xFF0C;&#x53EF;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5B8C;&#x6574;&#x5E93;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x5F15;&#x7528;&#x63A5;&#x53E3;&#x5C42;&#xFF08;&#x4F7F;&#x7528;Native SDK&#x65F6;&#xFF09;&#x6216;&#x5B9E;&#x73B0;&#x5C42;&#xFF08;&#x6A21;&#x62DF;Native SDK bridge&#xFF09;"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@bone/channel"><meta property="twitter:description" content="channel&#x4E3A;&#x57FA;&#x4E8E;mqtt&#x7684;&#x957F;&#x8FDE;&#x63A5;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#x5C01;&#x88C5;&#xFF0C;&#x53EF;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5B8C;&#x6574;&#x5E93;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x5F15;&#x7528;&#x63A5;&#x53E3;&#x5C42;&#xFF08;&#x4F7F;&#x7528;Native SDK&#x65F6;&#xFF09;&#x6216;&#x5B9E;&#x73B0;&#x5C42;&#xFF08;&#x6A21;&#x62DF;Native SDK bridge&#xFF09;"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a href="http://gitlab.alibaba-inc.com/bone/channel.git">Repository</a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/NativeImplement.js~ChannelNativeBridge.html">ChannelNativeBridge</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/WebImplement.js~ChannelWebBridge.html">ChannelWebBridge</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/WebSimulatorImplement.js~ChannelWebBridge.html">ChannelWebBridge</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/Interface.js~ChannelInterface.html">ChannelInterface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CHANNEL">CHANNEL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CHANNEL_CONNECT_STATUS_CHANGE">CHANNEL_CONNECT_STATUS_CHANGE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CHANNEL_CONNECT_STATUS_CONNECTED">CHANNEL_CONNECT_STATUS_CONNECTED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CHANNEL_CONNECT_STATUS_DISCONNECTED">CHANNEL_CONNECT_STATUS_DISCONNECTED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CHANNEL_MESSAGE">CHANNEL_MESSAGE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CHANNEL_NA_CONNECT_STATUS_CHANGE">CHANNEL_NA_CONNECT_STATUS_CHANGE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CHANNEL_NA_DOWSTREAM">CHANNEL_NA_DOWSTREAM</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Interface.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { CHANNEL, CHANNEL_MESSAGE, CHANNEL_CONNECT_STATUS_CHANGE } from &apos;./constants&apos;;
import EventEmitter from &apos;@bone/event-emitter&apos;;
import logger from &apos;@bone/logger&apos;;

const log = logger.create({
    module: &apos;ChannelInterface&apos;,
    label: [&apos;Bone&apos;, &apos;channel&apos;]
});

/**
 * channel&#x63A5;&#x53E3;&#x5C42;
 * @interface
 */
class ChannelInterface {
    /**
     * &#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x53D8;&#x66F4;&#x4E8B;&#x4EF6;&#x540D;
     * @type {String}
     */
    EVENT_CONNECT_STATUS_CHANGE = CHANNEL_CONNECT_STATUS_CHANGE;

    constructor({
        bridge
    }){
        /**
         * bridge&#x5F15;&#x7528;
         * @private
         * @type {Object} 
         */
        this.bridge = bridge;

        Object.assign(this, EventEmitter);
        
        // delegate event
        bridge.on(CHANNEL_CONNECT_STATUS_CHANGE, onConnectStatusChange.bind(this));
    }

    /**
     * &#x542F;&#x52A8;&#x63A5;&#x53E3;&#xFF0C;channel&#x7684;&#x5176;&#x4ED6;&#x63A5;&#x53E3;&#x5FC5;&#x987B;&#x7B49;&#x5230;ready&#x4E4B;&#x540E;&#x624D;&#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x7684;&#x8C03;&#x7528;
     * @param {Object} conf &#x542F;&#x52A8;&#x914D;&#x7F6E;
     * @param {String} conf.id &#x7528;&#x6237;id
     * @param {String} conf.token &#x7528;&#x6237;&#x767B;&#x5F55;&#x6001;token
     * @returns {Promise}
     * @example
     *  channel
     *      .ready()
     *      .then(()=&gt;{
     *          // safe to call channel methods now
     *          channel.subscribe(&apos;/demo/push&apos;, (msg)=&gt;{
     *              console.log(msg);
     *          });
     *      })
     *      .catch((err)=&gt;{
     *          // initialization failed
     * 
     *          // handle error here
     *          console.error(err);
     *      });
     */
    ready(conf){
        log.debug(&apos;ready: waiting for interface to be ready&apos;, conf);

        return new Promise((resolve, reject)=&gt;{
            this.bridge.call(CHANNEL, &apos;ready&apos;, [conf], (err)=&gt;{
                if(err){
                    log.warn(&apos;ready: initialization error&apos;, err);

                    reject(err);
                    return;
                }

                log.debug(&apos;ready: initialization done&apos;, err);
                resolve();
            });
        });
    }

    /**
     * &#x8BA2;&#x9605;topic
     * @param {String} topic &#x9700;&#x8981;&#x8BA2;&#x9605;&#x7684;topic
     * @param {Function} callback topic&#x7684;&#x54CD;&#x5E94;&#x51FD;&#x6570;&#xFF0C;&#x6CE8;&#x610F;&#xFF1A;&#x8BE5;&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x88AB;&#x591A;&#x6B21;&#x8C03;&#x7528;
     * @example
     *      channel.subscribe(&apos;/demo/push&apos;, (msg)=&gt;{
     *          console.log(&apos;/demo/push message received:&apos;, msg);
     *      });
     */
    subscribe(topic, callback){
        log.debug(&apos;subscribe:&apos;, topic);
        this.bridge.call(CHANNEL, &apos;subscribe&apos;, [topic], callback);
    }

    /**
     * &#x53D6;&#x6D88;&#x8BA2;&#x9605;
     * @param {String} topic &#x53D6;&#x6D88;&#x8BA2;&#x9605;&#x7684;topic 
     * @param {Function} callback &#x8BA2;&#x9605;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x54CD;&#x5E94;&#x51FD;&#x6570;&#xFF0C;&#x6CE8;&#x610F;&#xFF1A;&#x5FC5;&#x987B;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5426;&#x5219;&#x65E0;&#x6CD5;&#x53D6;&#x6D88;&#x8BA2;&#x9605;
     * @example
     *      channel.unsubscribe(&apos;/demo/push&apos;, callback);
     */
    unsubscribe(topic, callback){
        log.debug(&apos;unsubscribe:&apos;, topic);
        this.bridge.call(CHANNEL, &apos;unsubscribe&apos;, [topic], callback);
    }

    /**
     * &#x53D1;&#x5E03;topic
     * @param {String} topic &#x9700;&#x8981;&#x53D1;&#x5E03;&#x7684;topic
     * @param {Object} payload topic&#x7684;&#x6D88;&#x606F;&#x5185;&#x5BB9;
     * @param {Function} callback topic&#x53D1;&#x5E03;&#x6210;&#x529F;&#x65F6;&#x7684;&#x56DE;&#x8C03;
     * @example
     *      channel.publish(
     *          &apos;/demo/publish_topic&apos;, 
     *          { msg: &apos;hello&apos; }
     *          ()=&gt;{
     *              console.log(&apos;/demo/publish_topic message sent&apos;);
     *          }
     *      );
     */
    publish(topic, payload, callback){
        log.debug(&apos;publish:&apos;, topic, payload);
        this.bridge.call(CHANNEL, &apos;publish&apos;, [topic, payload], callback);
    }

    /**
     * RPC&#x8BF7;&#x6C42;&#xFF0C;&#x5373;&#x5229;&#x7528;&#x957F;&#x8FDE;&#x901A;&#x9053;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x7684;&#x52A8;&#x4F5C;
     * @param {String} topic &#x505A;RPC&#x8BF7;&#x6C42;&#x7684;topic
     * @param {Object} payload topic&#x7684;&#x6D88;&#x606F;&#x5185;&#x5BB9;
     * @param {Function} callback RPC&#x7684;&#x54CD;&#x5E94;&#x62A5;&#x6587;&#x56DE;&#x8C03;&#x51FD;&#x6570;
     * @example
     *      channel.request(
     *          &apos;/demo/rpc_topic&apos;,
     *          { msg: &apos;hello&apos; }
     *          (err, res)=&gt;{
     *              if(err){
     *                  console.warn(&apos;/demo/rpc_topic message error:&apos;, err);
     *                  return;
     *              }
     * 
     *              console.log(&apos;/demo/rpc_topic response message:&apos;, res);
     *          }
     *      )
     */
    request(topic, payload, callback){
        log.debug(&apos;request:&apos;, topic, payload);
        this.bridge.call(CHANNEL, &apos;request&apos;, [topic, payload], callback);
    }
}

function onConnectStatusChange(...args){
    /**
     * &#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x53D8;&#x5316;&#x4E8B;&#x4EF6;
     * @event
     * @param {String} &#x5F53;&#x524D;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#xFF1A;connected/disconnected
     */
    this.emit(CHANNEL_CONNECT_STATUS_CHANGE, ...args);
}

export default ChannelInterface;</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
